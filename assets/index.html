<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Try out Twilio!</title>

        <link rel="icon" href="https://twilio-labs.github.io/function-templates/static/v1/favicon.ico">
        <link rel="stylesheet" href="https://twilio-labs.github.io/function-templates/static/v1/ce-paste-theme.css">
        <script src="https://twilio-labs.github.io/function-templates/static/v1/ce-helpers.js" defer></script>
        <script>
         window.addEventListener('DOMContentLoaded', (_event) => {
             inputPrependBaseURL();
         });
        </script>
    </head>
    <body>
        <div class="page-top">
            <header>
                <div id="twilio-logo">
                    <a href="https://www.twilio.com/" target="_blank" rel="noopener">
                        <svg class="logo" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 60 60">
                            <title>Twilio Logo</title><path class="cls-1" d="M30,15A15,15,0,1,0,45,30,15,15,0,0,0,30,15Zm0,26A11,11,0,1,1,41,30,11,11,0,0,1,30,41Zm6.8-14.7a3.1,3.1,0,1,1-3.1-3.1A3.12,3.12,0,0,1,36.8,26.3Zm0,7.4a3.1,3.1,0,1,1-3.1-3.1A3.12,3.12,0,0,1,36.8,33.7Zm-7.4,0a3.1,3.1,0,1,1-3.1-3.1A3.12,3.12,0,0,1,29.4,33.7Zm0-7.4a3.1,3.1,0,1,1-3.1-3.1A3.12,3.12,0,0,1,29.4,26.3Z"/></svg>
                    </a>
                </div>
                <nav>
                    <span>Twilio Verify</span>
                    <aside>
                        <svg class="icon" role="img" aria-hidden="true" width="100%" height="100%" viewBox="0 0 20 20" aria-labelledby="NewIcon-1577"><path fill="currentColor" fill-rule="evenodd" d="M6.991 7.507c.003-.679 1.021-.675 1.019.004-.012 2.956 1.388 4.41 4.492 4.48.673.016.66 1.021-.013 1.019-2.898-.011-4.327 1.446-4.48 4.506-.033.658-1.01.639-1.018-.02-.03-3.027-1.382-4.49-4.481-4.486-.675 0-.682-1.009-.008-1.019 3.02-.042 4.478-1.452 4.49-4.484zm.505 2.757l-.115.242c-.459.9-1.166 1.558-2.115 1.976l.176.08c.973.465 1.664 1.211 2.083 2.22l.02.05.088-.192c.464-.973 1.173-1.685 2.123-2.124l.039-.018-.118-.05c-.963-.435-1.667-1.117-2.113-2.034l-.068-.15zm10.357-8.12c.174.17.194.434.058.625l-.058.068-1.954 1.905 1.954 1.908a.482.482 0 010 .694.512.512 0 01-.641.056l-.07-.056-1.954-1.908-1.954 1.908a.511.511 0 01-.71 0 .482.482 0 01-.058-.626l.058-.068 1.954-1.908-1.954-1.905a.482.482 0 010-.693.512.512 0 01.64-.057l.07.057 1.954 1.905 1.954-1.905a.511.511 0 01.71 0z"></path></svg>
                        Live
                    </aside>
                </nav>
            </header>
        </div>
        <main>
            <div class="content">
                <h1>
                    <img src="https://twilio-labs.github.io/function-templates/static/v1/success.svg" />
                    <div>
                        <p>Welcome!</p>
                        <p>Please have fun playing with some Twilio APIs!</p>
                    </div>
                </h1>
                <section> 
                    <h2>Table of Contents</h2>
                <ul>
                    <li><a href="#lookup">Twilio Lookup</a></li>
                    <li><a href="#lookup-idmatch">Twilio Lookup Identity Match</a></li>
                    <li><a href="#verify">Twilio Verify</a></li>
                    <li><a href="#verify-safelist">Twilio Verify Fraud Guard & Safe List</a></li>
                    <li><a href="#verify-sna">Twilio Verify Silent Network Authentication</a></li>
                    <li><a href="#prog-sms">Twilio Programmable SMS</a></li>
                    <li><a href="#studio">Twilio Studio</a></li>
                    <li><a href="#email">Twilio SendGrid Email API</a></li>

                </ul>
                </section>
                <section>
                    <h2 id="lookup">This section will allow you to test our Twilio Lookup Features</h2>
                    <p>
                        This API allows you to query information on a phone number so that you can make a trusted interaction with your user. <a href = "https://www.twilio.com/docs/lookup/v2-api" target="_blank">Learn more.</a>
                    </p>
                    <ol class="steps">
                        <li>
                            Input your phone number in E.164 format to lookup.
                        </li>
                        <input type="text" id="twilio-lookup-phone" class="phone-number" onfocus="this.value=''">
                        <li>
                            Select which lookup you would like to perform (Caller Name is only supported in US)
                        </li>
        <div style="display:flex; justify-content:center; padding:1rem 0;">
            <button onclick="lookupFunction('validation')"
                style="
                        background-color: white;
                        color:  rgb(2, 99, 224);
                        border: 1px solid rgb(2, 99, 224);
                        border-radius: 4px;
                        font-size: 14px;
                        font-weight: 600;
                        text-decoration: none;
                        padding: 6px 12px;
                        margin-left: 10px;
                        margin-right: 10px;"
            >Validation</a>
            
            <button onclick="lookupFunction('line_type_intelligence')"
            style="
                    background-color: white;
                    color:  rgb(2, 99, 224);
                    border: 1px solid rgb(2, 99, 224);
                    border-radius: 4px;
                    font-size: 14px;
                    font-weight: 600;
                    text-decoration: none;
                    padding: 6px 12px;
                    margin-left: 10px;
                    margin-right: 10px;"
            >Line Type Intelligence</a>

            <button onclick="lookupFunction('caller_name')"
            style="
                    background-color: white;
                    color:  rgb(2, 99, 224);
                    border: 1px solid rgb(2, 99, 224);
                    border-radius: 4px;
                    font-size: 14px;
                    font-weight: 600;
                    text-decoration: none;
                    padding: 6px 12px;
                    margin-left: 10px;
                    margin-right: 10px;"
            >Caller Name</a>
                    </ol>
                    <div id = lookupResults> </div>
                </section>
                <section>
                    <h2 id="lookup-idmatch">This section will allow you to test our Twilio Lookup Identity Match Feature</h2>
                    <p>
                        This API will allow you to get confirmation of ownership for a mobile phone number by comparing user-provided information against authoritative data sources.
                        You may fill in some or all fields for comparison. <a href = "https://www.twilio.com/docs/lookup/v2-api/identity-match" target="_blank">Learn More!</a> 
                    </p>
                    <ul>
                        <li>Input your phone number in E.164 format.</li>
                        <input type="text" id="idmatch-phone" class="phone-number"  onfocus="this.value=''">
                        <li>Input your first name.</li>
                        <input type="text" id="idmatch-firstname"  onfocus="this.value=''">
                        <li>Input your last name.</li>
                        <input type="text" id="idmatch-lastname"  onfocus="this.value=''">
                        <li>Input your address.</li>
                        <input type="text" id="idmatch-address"  onfocus="this.value=''">
                        <li>Input your city.</li>
                        <input type="text" id="idmatch-city"  onfocus="this.value=''">
                        <li>Input your state.</li>
                        <input type="text" id="idmatch-state"  onfocus="this.value=''">
                        <li>Input your postal code.</li>
                        <input type="text" id="idmatch-postalcode"  onfocus="this.value=''">
                        <li>Input your date of birth [YYYYMMDD].</li>
                        <input type="text" id="idmatch-dob"  onfocus="this.value=''">
                    </ul>
                    <div style="display:flex; justify-content:center; padding:1rem 0;">
                        <button onclick="identityMatchFunction()"
                            style="
                                    background-color: white;
                                    color:  rgb(2, 99, 224);
                                    border: 1px solid rgb(2, 99, 224);
                                    border-radius: 4px;
                                    font-size: 14px;
                                    font-weight: 600;
                                    text-decoration: none;
                                    padding: 6px 12px;
                                    margin-left: 10px;
                                    margin-right: 10px;"
                        >Check Matches</a>
                        
                </section>
                <div id = identityMatchResults></div>
                
                <section>
                    <h2 id="verify">This section will allow you to test our Twilio Verify Features</h2>
                    <p>
                        This API will let you send a user verification code (OTP) via SMS, Voice or Whatsapp! <a href = "https://www.twilio.com/docs/verify/api" target="_blank">Learn More!</a> 
                    </p>
                    <ol class="steps">
                        <li>
                            Input your phone number in E.164 format to receive the OTP.
                        </li>
                        <input type="text" id="twilio-to-phone" class="phone-number"  onfocus="this.value=''">
                        <li>
                            Select which channel you would like to receive your code
                        </li>
        <div style="display:flex; justify-content:center; padding:1rem 0;">
            <button onclick="sendOtpFunction('sms')"
                style="
                        background-color: white;
                        color:  rgb(2, 99, 224);
                        border: 1px solid rgb(2, 99, 224);
                        border-radius: 4px;
                        font-size: 14px;
                        font-weight: 600;
                        text-decoration: none;
                        padding: 6px 12px;
                        margin-left: 10px;
                        margin-right: 10px;"
            >Send as SMS</a>
            
            <button onclick="sendOtpFunction('call')"
            style="
                    background-color: white;
                    color:  rgb(2, 99, 224);
                    border: 1px solid rgb(2, 99, 224);
                    border-radius: 4px;
                    font-size: 14px;
                    font-weight: 600;
                    text-decoration: none;
                    padding: 6px 12px;
                    margin-left: 10px;
                    margin-right: 10px;"
            >Send as Voice</a>

            <button onclick="sendOtpFunction('whatsapp')"
            style="
                    background-color: white;
                    color:  rgb(2, 99, 224);
                    border: 1px solid rgb(2, 99, 224);
                    border-radius: 4px;
                    font-size: 14px;
                    font-weight: 600;
                    text-decoration: none;
                    padding: 6px 12px;
                    margin-left: 10px;
                    margin-right: 10px;"
            >Send as Whatsapp</a>
            
            <!-- <button onclick="sendOtpFunction('sna')"
            style="
                    background-color: white;
                    color:  rgb(2, 99, 224);
                    border: 1px solid rgb(2, 99, 224);
                    border-radius: 4px;
                    font-size: 14px;
                    font-weight: 600;
                    text-decoration: none;
                    padding: 6px 12px;
                    margin-left: 10px;
                    margin-right: 10px;"
            >Send as SNA</a> -->
        </div>
        <div id = verifySendResults> </div>
                        <li>
                            Input the OTP Code you received.
                        </li>
                        <input type="text" id="twilio-otp" class="OTP" value="xxxxxx" onfocus="this.value=''">
<div style="display:flex; justify-content:center; padding:1rem 0;">
            <button onclick="verifyOtpFunction()"
                style="
                        background-color: white;
                        color:  rgb(2, 99, 224);
                        border: 1px solid rgb(2, 99, 224);
                        border-radius: 4px;
                        font-size: 14px;
                        font-weight: 600;
                        text-decoration: none;
                        padding: 6px 12px;
                        margin-left: 10px;
                        margin-right: 10px;"
            >Verify</a>
            
            <!-- <button onclick="verifySNAFunction()"
                style="
                        background-color: white;
                        color:  rgb(2, 99, 224);
                        border: 1px solid rgb(2, 99, 224);
                        border-radius: 4px;
                        font-size: 14px;
                        font-weight: 600;
                        text-decoration: none;
                        padding: 6px 12px;
                        margin-left: 10px;
                        margin-right: 10px;"
            >Verify SNA*</a> -->
        </div>
                    </ol>
                    <div id = verifyOTPResults> </div>
                </section>
                <section>
                    <h2 id="verify-safelist">This section will allow you to test our Twilio Safe List Feature</h2>
                    <p>
                        This API will allow you to add/remove/check a phone number against a Safe List. Verify Fraud Guard prevents SMS related fraud by monitoring your traffic and blocking suspicious destinations. The Safe List is an "allow-list" of confirmed customer phone numbers who won't be blocked.
                        <a href = "https://www.twilio.com/docs/verify/preventing-toll-fraud/sms-fraud-guard" target="_blank"> Learn more about Fraud Guard! </a> <p> </p>
                        <a href = "https://www.twilio.com/docs/verify/api/safe-list" target="_blank"> Learn more about the Safe List! </a>

                    </p>
                    <ol class="steps">
                        <li>
                            Input your phone number in E.164 format.
                        </li>
                        <input type="text" id="twilio-safelist-phone" class="phone-number"  onfocus="this.value=''">
                        <li>
                            Select which action you would like to perform
                        </li>
        <div style="display:flex; justify-content:center; padding:1rem 0;">
            <button onclick="safelistFunction('check')"
                style="
                        background-color: white;
                        color:  rgb(2, 99, 224);
                        border: 1px solid rgb(2, 99, 224);
                        border-radius: 4px;
                        font-size: 14px;
                        font-weight: 600;
                        text-decoration: none;
                        padding: 6px 12px;
                        margin-left: 10px;
                        margin-right: 10px;"
            >Check Number</a>
            
            <button onclick="safelistFunction('add')"
            style="
                    background-color: white;
                    color:  rgb(2, 99, 224);
                    border: 1px solid rgb(2, 99, 224);
                    border-radius: 4px;
                    font-size: 14px;
                    font-weight: 600;
                    text-decoration: none;
                    padding: 6px 12px;
                    margin-left: 10px;
                    margin-right: 10px;"
            >Add Number</a>

            <button onclick="safelistFunction('remove')"
            style="
                    background-color: white;
                    color:  rgb(2, 99, 224);
                    border: 1px solid rgb(2, 99, 224);
                    border-radius: 4px;
                    font-size: 14px;
                    font-weight: 600;
                    text-decoration: none;
                    padding: 6px 12px;
                    margin-left: 10px;
                    margin-right: 10px;"
            >Remove Number</a>
        
                    </ol>
                    <div id = safeListResults> </div>
                </section>
                <section>
                    <h2 id="verify-sna">This section will let you watch Verify Silent Network Authentication in action.</h2>
                    <ol > 
                            <b>Verify Silent Network Auth:</b> Silent Network Auth (SNA) is the next generation SIM-based authentication method that confirms phone number possession in real-time without compromising security.
                            Watch a video showing the enhanced SNA experience compared to traditional SMS OTPs <a href="https://assets.cdn.prod.twilio.com/media/OWLMart_Login_SNA_SMS_Side_by_Side.mp4" target="_blank">here.</a>
                            
                         <div style="display:flex; justify-content:center; padding:1rem 0;">
        
                    </ol>
            
                </section>
                        <!-- <p>
                            * Verify SNA Live Number Test - You can only register one number per account at a time, so this will not work for you. Get the code <a href="https://github.com/nataliehuynh/TwilioTrustedActivation">here</a> and build your own instance
                        </p> -->
                <section>
                    <h2 id="prog-sms">This section will allow you to test Twilio Programmable SMS</h2>
                    <p>
                        Twilio makes sending SMS easy. 
                        <a href = "https://www.twilio.com/docs/sms" target="_blank"> Learn more! </a>
                        <!-- Twilio Programmable Voice helps you make, receive, and monitor calls around the world.
                        <a href = "https://www.twilio.com/docs/voice/api" target="_blank"> Learn more! </a> -->

                    </p>
                    <ol class="steps">
                        <li>
                            Input your phone number in E.164 format.
                        </li>
                        <input type="text" id="sms-phone" class="phone-number"  onfocus="this.value=''">
                        <li>
                            Enter your message. 
                        </li>
                        <textarea rows="4" cols="80" id="twilio-message" > </textarea>
        <div style="display:flex; justify-content:center; padding:1rem 0;">
            
            
            <button onclick="sendSMS()"
        style="
                background-color: white;
                color:  rgb(2, 99, 224);
                border: 1px solid rgb(2, 99, 224);
                border-radius: 4px;
                font-size: 14px;
                font-weight: 600;
                text-decoration: none;
                padding: 6px 12px;
                margin-left: 10px;
                margin-right: 10px;"
    >Send SMS</a>
    
    <!-- <button onclick="sendVoice()"
    style="
            background-color: white;
            color:  rgb(2, 99, 224);
            border: 1px solid rgb(2, 99, 224);
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
            text-decoration: none;
            padding: 6px 12px;
            margin-left: 10px;
            margin-right: 10px;"
    >Send Voice Message</a> -->

        
                    </ol>
                    <div id = messageSendResults> </div>
                </section>
                        
                <section>
                    <h2 id="studio">This section will let you experience Twilio Studio in action.</h2>
                    
                    <ol >
                                            
                        <b>Twilio Studio:</b> Studio is a low-code/no-code application builder with drag and drop widgets to build voice, messaging, and communications apps.
                            <p></p>Call or text <b>+1(218)-277-7990</b> to witness Twilio Studio in action! 
                    
                        <div style="display:flex; justify-content:center; padding:1rem 0;">
        
                    </ol>
                </section>
                <section>
                    <h2 id="email">This section will allow you to test Twilio SendGrid Email API</h2>
                    <p>
                        Twilio SendGrid is a leader in trusted email delivery, processing over 130 billion emails per month. 
                        <a href = "https://www.twilio.com/en-us/sendgrid/email-api" target="_blank"> Learn more! </a>
                        <!-- Twilio Programmable Voice helps you make, receive, and monitor calls around the world.
                        <a href = "https://www.twilio.com/docs/voice/api" target="_blank"> Learn more! </a> -->

                    </p>
                    <ol class="steps">
                        <li>
                            Input your email address.
                        </li>
                        <input type="text" id="email-address"  onfocus="this.value=''">
                        <li>
                            Enter your subject line. 
                        </li>
                        <input type="text" id="email-subject"  onfocus="this.value=''">
                        <li>
                            Enter your email body. 
                        </li>
                        <textarea rows="4" cols="80" id="email-body" > </textarea>
        <div style="display:flex; justify-content:center; padding:1rem 0;">
            
            
            <button onclick="sendEmail()"
        style="
                background-color: white;
                color:  rgb(2, 99, 224);
                border: 1px solid rgb(2, 99, 224);
                border-radius: 4px;
                font-size: 14px;
                font-weight: 600;
                text-decoration: none;
                padding: 6px 12px;
                margin-left: 10px;
                margin-right: 10px;"
    >Send Email</a>        
                    </ol>
                    <div id = emailSendResults> </div>
                </section>

        </main>
        <footer>
            <span class="statement">We can't wait to see what you build.</span>
        </footer>

<script>
    async function sendOtpFunction(channel){
        var toNumber = document.getElementById("twilio-to-phone").value;
        var encode_toNumber = encodeURIComponent (toNumber);
        const results =  await fetch('/send_otp', {
            method: 'POST',
            headers: {
                Accept: 'application/json',
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({To: encode_toNumber, Channel: channel})
        });   
        const info = await results.json();
        console.log(info);
        const format = JSON.stringify(info, null, 2);
        document.getElementById('verifySendResults').innerHTML = format;  
    }
    async function verifyOtpFunction(){
        var toNumber = document.getElementById("twilio-to-phone").value;
        var encode_toNumber = encodeURIComponent (toNumber);
        var otpCode = document.getElementById("twilio-otp").value;
        const results =  await fetch('/verify_otp', {
            method: 'POST',
            headers: {
                Accept: 'application/json',
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({To: encode_toNumber, Code: otpCode})
        }); 
        const info = await results.json();
        const format = JSON.stringify(info, null, 2);
        document.getElementById('verifyOTPResults').innerHTML = format;    
       
    }

    //this doesn't work right now
    function verifySNAFunction(){
        var toNumber = document.getElementById("twilio-to-phone").value;
        var encode_toNumber = encodeURIComponent (toNumber);
        var otpCode = document.getElementById("twilio-otp").value;
        //var urlSend = context.DOMAIN_NAME + "/verify_sna?To=" + encode_toNumber;
        window.open(urlSend, '_blank');
        //window.location.href=urlSend;
    }

    async function lookupFunction(lookupType){
        var toNumber = document.getElementById("twilio-lookup-phone").value;
        var otpCode = document.getElementById("twilio-otp").value;
        var encode_toNumber = encodeURIComponent (toNumber);
        const results =  await fetch('/lookup_type', {
            method: 'POST',
            headers: {
                Accept: 'application/json',
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({To: encode_toNumber, Type: lookupType})
        });        
        const info = await results.json();
        let text = "<table border='1'>"
            for (let x in info) {
              text += "<tr>" + "<td>" + x + "</td><td>" + info[x] + "</td>" +" </tr>";
            }
            text += "</table>"
            document.getElementById("lookupResults").innerHTML = text;
       // document.getElementById('lookupResults').innerHTML = "Results: " + format;         
    }

    async function identityMatchFunction(lookupType){
        var toNumber = document.getElementById("idmatch-phone").value;
        var firstName = document.getElementById("idmatch-firstname").value;
        var lastName = document.getElementById("idmatch-lastname").value;
        var address = document.getElementById("idmatch-address").value;
        var city = document.getElementById("idmatch-city").value;
        var state = document.getElementById("idmatch-state").value;
        var postalCode = document.getElementById("idmatch-postalcode").value;
        var DOB = document.getElementById("idmatch-dob").value;
        var encode_toNumber = encodeURIComponent (toNumber);
        const results =  await fetch('/identity_match', {
            method: 'POST',
            headers: {
                Accept: 'application/json',
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({To: encode_toNumber, firstName: firstName, lastName: lastName, address: address, city: city, state: state, postalCode: postalCode, DOB: DOB })
        });        
        const info = await results.json();
        const format = JSON.stringify(info, null, 2);
        let text = "<table border='1'>"
            for (let x in info) {
              text += "<tr>" + "<td>" + x + "</td><td>" + info[x] + "</td>" +" </tr>";
            }
            text += "</table>"
            document.getElementById("identityMatchResults").innerHTML = text;
       // document.getElementById('identityMatchResults').innerHTML = "Results: " + format;         
    }

    async function safelistFunction(safelistAction){
        var toNumber = document.getElementById("twilio-safelist-phone").value;
        var encode_toNumber = encodeURIComponent (toNumber);
        var otpCode = document.getElementById("twilio-otp").value;
        const results =  await fetch('/safe_list', {
            method: 'POST',
            headers: {
                Accept: 'application/json',
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({To: encode_toNumber, Action: safelistAction})
        });   
        const info = await results.json();
        const format = JSON.stringify(info, null, 2);
        document.getElementById('safeListResults').innerHTML = "Results: " + format;  
    }

    async function sendSMS(){
        var toNumber = document.getElementById("sms-phone").value;
        var message = document.getElementById("twilio-message").value;
        var encode_toNumber = encodeURIComponent (toNumber);
        const results =  await fetch('/send_sms', {
            method: 'POST',
            headers: {
                Accept: 'application/json',
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({To: encode_toNumber, message: message})
        });   
        const info = await results.json();
        console.log(info);
        const format = JSON.stringify(info, null, 2);
        document.getElementById('MessageSendResults').innerHTML = format; 
    }

    async function sendEmail(){
        var to = document.getElementById("email-address").value;
        var subject = document.getElementById("email-subject").value;
        var body = document.getElementById("email-body").value;

        const results =  await fetch('/send_email', {
            method: 'POST',
            headers: {
                Accept: 'application/json',
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({to: to, subject: subject, body: body})
        });   
        const info = await results.json();
        console.log(info);
        const format = JSON.stringify(info, null, 2);
        document.getElementById('emailSendResults').innerHTML = format; 
    }


</script>



    </body>
</html>